# 上传漏洞

---

## 客户端检测

```
请求的页面中限制了只能jpg,png等文件上传
上传一个<?php phpinfo();?>的jpg文件
bp抓包上传时将jpg后缀修改为php后缀即可
上传成功会输出上传路径与url进行构造即可
```

## 服务端检测

```
通过$_file函数对请求头是否为：Content-Type:image/jpeg 

第一种：
上传一个<?php phpinfo();?>的jpg文件
bp抓包上传时将jpg后缀修改为php后缀即可
上传成功会输出上传路径与url进行构造即可

第二种：
直接传php文件，然后修改请求头Content-Type:image/jpeg 也可

```

## getimagesize

```
geiimagesize会返回文件大小和文件类型来来进行判断

PS：linux的xxd 1.png|head -n 1  #查看图片文件的16进制第一行 可以看到文件头，该函数就是通过文件进行判断文件类型

可以使用windows的cmd：

copy /b 2.png + 1.php  xxx.png  #将2.png和1.php 合并成xxx.png
```

### 上传拓展名限制

```
包内容增加以下，文件名修改成php或jsp
----
Content-Disposition: form-data; name="extensions"
jpg,jpeg,gif,png,php,jsp
```

### 上传黑名单绕过：

```

```

### 上传demo

```
<html>
<body>
<form action="http://xxxx.com/upload-file.php" method="post"
enctype="multipart/form-data">
<label for="file">Filename:</label>
<input type="file" name="file" id="file" />
<br/>
<input type="submit" name="submit" value="Submit" />
</form>
</body>
</html> 
```

